<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Варильні поверхні</title>
    <link rel="stylesheet" href="../css/main.css">
</head>

<body>
    <!-- Шапка -->
    <header>
        <h1>Варильні поверхні</h1>
    </header>

    <!-- Основний вміст -->
    <div class="container" id="container">
        <div class="burger" id="burger">
            <div></div>
            <div></div>
            <div></div>
        </div>
        <div class="menu" id="menu"></div>

        <h1>Звіт</h1>
        <!-- <p class="date">August 31, 2025</p> -->

        <div class="topic-container">


            <div class="text-content">
                <div class="labels">
                    <h2 class="topic_name k14">К14</h2>
                    <h2 class="topic_name">План</h2>
                    <h2 class="topic_name">Факт</h2>
                    <h2 class="topic_name">% виконаня</h2>
                    <h2 class="topic_name">% проникненя</h2>
                </div>
                <div class="results">
                    <div class="name-daily">IT</div>
                    <div class="col-3">
                        <input class="effect-1 plan" type="text" placeholder="План">
                        <span class="focus-border"></span>
                    </div>
                    <div class="col-3">
                        <input class="effect-1 fact" type="text" placeholder="Факт">
                        <span class="focus-border"></span>
                    </div>
                    <div class="col-3">
                        <input class="effect-1 percent" type="text" placeholder="% виконання" readonly>
                        <span class="focus-border"></span>
                    </div>
                    <div class="col-3">
                        <input class="effect-1" type="text" placeholder="% проникнення">
                        <span class="focus-border"></span>
                    </div>
                </div>

                <div class="results">
                    <div class="name-daily">ХС</div>
                    <div class="col-3">
                        <input class="effect-1 plan" type="text" placeholder="План">
                        <span class="focus-border"></span>
                    </div>
                    <div class="col-3">
                        <input class="effect-1 fact" type="text" placeholder="Факт">
                        <span class="focus-border"></span>
                    </div>
                    <div class="col-3">
                        <input class="effect-1 percent" type="text" placeholder="% виконання" readonly>
                        <span class="focus-border"></span>
                    </div>
                    <div class="col-3">
                        <input class="effect-1" type="text" placeholder="% проникнення">
                        <span class="focus-border"></span>
                    </div>
                </div>




                <div class="results trade">
                    <div class="name-daily">Trade-in</div>
                    <div class="col-3">
                        <input class="effect-1 fact" type="text" placeholder="Факт">
                        <span class="focus-border"></span>
                    </div>
                </div>
                <div class="results">
                    <div class="name-daily">Телефони</div>
                    <div class="col-3">
                        <input class="effect-1 fact" type="text" placeholder="Факт">
                        <span class="focus-border"></span>
                    </div>
                </div>
                <div class="results">
                    <div class="name-daily">Ноутбуки</div>
                    <div class="col-3">
                        <input class="effect-1 fact" type="text" placeholder="Факт">
                        <span class="focus-border"></span>
                    </div>
                </div>
                <div class="results">
                    <div class="name-daily">Телевізори</div>
                    <div class="col-3">
                        <input class="effect-1 fact" type="text" placeholder="Факт">
                        <span class="focus-border"></span>
                    </div>
                </div>

                <button id="copy-it">Copy IT</button> <button id="copy-all">Copy All</button>
            </div>

        </div>
    </div>
</body>

<script src="../js/main.js"></script>
<script>
    document.querySelectorAll('.results').forEach((block, index) => {
        const inputs = block.querySelectorAll('input'); // всі поля в блоці

        function calculate() {
            const planInput = block.querySelector('.plan');
            const factInput = block.querySelector('.fact');
            const percentInput = block.querySelector('.percent');

            if (planInput && factInput && percentInput) {
                const plan = parseFloat(planInput.value.replace(/\s/g, '')) || 0;
                const fact = parseFloat(factInput.value.replace(/\s/g, '')) || 0;

                if (plan > 0) {
                    percentInput.value = ((fact / plan) * 100).toFixed(2) + '%';
                } else {
                    percentInput.value = '';
                }
            }
            saveData();
        }

        // збереження в localStorage
        function saveData() {
            const data = {};
            inputs.forEach((inp, i) => {
                data[i] = inp.value;
            });
            localStorage.setItem('results-' + index, JSON.stringify(data));
        }

        // завантаження з localStorage
        function loadData() {
            const saved = localStorage.getItem('results-' + index);
            if (saved) {
                const data = JSON.parse(saved);
                inputs.forEach((inp, i) => {
                    if (data[i] !== undefined) {
                        inp.value = data[i];
                    }
                });
            }
        }

        // обробники для кожного input
        inputs.forEach(inp => {
            if (inp.placeholder === "% проникнення") {
                // спеціальне правило для % проникнення
                inp.addEventListener('input', () => {
                    let val = inp.value;

                    // якщо ввели щось окрім цифр і крапки → підставляємо крапку
                    if (/[^0-9.]/.test(val)) {
                        val = val.replace(/[^0-9.]/g, '.');
                    }

                    // тільки одна крапка
                    let parts = val.split('.');
                    if (parts.length > 2) {
                        val = parts[0] + '.' + parts.slice(1).join('');
                    }

                    inp.value = val;
                    saveData();
                });

                inp.addEventListener('blur', () => {
                    let value = inp.value.replace(/\s/g, '');
                    if (value !== '' && !value.endsWith('%')) {
                        inp.value = value + '%';
                    }
                    saveData();
                });

                inp.addEventListener('focus', () => {
                    inp.value = inp.value.replace('%', '');
                });
            } else {
                inp.addEventListener('input', () => {
                    saveData();
                    calculate();
                });
            }
        });

        // при завантаженні сторінки відновлюємо дані
        loadData();
        calculate();
    });
</script>



<script>

    function getBlockData(name) {
        const blocks = document.querySelectorAll(".results");
        for (let block of blocks) {
            const title = block.querySelector(".name-daily");
            if (title && title.textContent.trim() === name) {
                const plan = block.querySelector(".plan")?.value.trim() || "0";
                const fact = block.querySelector(".fact")?.value.trim() || "0";
                const percentDone = block.querySelector(".percent")?.value.trim() || "0";
                const penetration = block.querySelector('input[placeholder="% проникнення"]')?.value.trim() || "0";
                return { plan, fact, percentDone, penetration };
            }
        }
        return null;
    }

    document.getElementById("copy-it").addEventListener("click", () => {
        const it = getBlockData("IT");
        const hs = getBlockData("ХС");
        const tr = getBlockData("Trade-in");
        const ph = getBlockData("Телефони");
        const lp = getBlockData("Ноутбуки");
        const tv = getBlockData("Телевізори");

        let text = `К14\n\n`;
        if (it) {
            text += `ІТ - ${it.plan} / ${it.fact} (${it.percentDone}) ${it.penetration}\n`;
        }
        if (hs) {
            text += `ХС - ${hs.plan} /  ${hs.fact} (${hs.percentDone}) ${hs.penetration}\n\n`;
        }
        if (tr) {
            text += `Trade-in - ${tr.fact}`;
        }

        navigator.clipboard.writeText(text);
        // alert("Copied IT!");
    });

    document.getElementById("copy-all").addEventListener("click", () => {
        const it = getBlockData("IT");
        const hs = getBlockData("ХС");
        const tr = getBlockData("Trade-in");
        const ph = getBlockData("Телефони");
        const lp = getBlockData("Ноутбуки");
        const tv = getBlockData("Телевізори");

        let text = `К14\n\n`;
        if (it) {
            text += `ІТ - ${it.plan} / ${it.fact} ${it.penetration} (${it.percentDone})\n`;
        }
        if (hs) {
            text += `ХС - ${hs.plan} /  ${hs.fact} ${hs.penetration} (${hs.percentDone})\n\n`;
        }
        if (tr) {
            text += `Trade-in - ${tr.fact}\n\n`;
        }
        if (ph) {
            text += `Телефони - ${ph.fact}\n`;
        }
        if (lp) {
            text += `Ноутбуки - ${lp.fact}\n`;
        }
        if (tv) {
            text += `Телевізори - ${tv.fact}\n`;
        }

        navigator.clipboard.writeText(text);
        // alert("Copied All!");
    });
</script>




</html>